/* =============================================================================
   MOBILE (single source of truth) — CLEANED (duplicates removed)
   Replace the entire file with this version.
   ============================================================================= */

@media (max-width: 900px){

  /* -----------------------------
     Global: prevent sideways scroll
     ----------------------------- */
  html, body{
    width: 100%;
    max-width: 100%;
    overflow-x: hidden !important;
  }

  body{
    margin: 0 !important;
    padding-top: var(--topbar-h) !important;
    padding-bottom: 74px !important; /* bottom tabs height */
  }

  .page-container{
    max-width: none !important;
    width: 100% !important;
    margin: 0 !important;
    padding: 0 6px !important;      /* default mobile gutter */
    padding-bottom: 80px !important;
    box-sizing: border-box !important;
  }

  /* Allow flex/grid children to shrink (prevents overflow) */
  .bank-main, .cat-main, .chart-card, .chart-header, .chart-header-center, .chart-header-dates{
    min-width: 0 !important;
  }

  /* =============================================================================
     HOME (mobile)
     ============================================================================= */

  body.page-home .bank-area{
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  body.page-home .bank-main{ order: 1; }
  body.page-home .sidebar-stack{ order: 2; }
  body.page-home #categoryTotals{ order: 3; }

  body.page-home .sidebar-stack,
  body.page-home #categoryTotals,
  body.page-home #monthBudget,
  body.page-home .category-box--sidebar{
    width: 100%;
    max-width: none;
    margin: 0;
    align-self: stretch;
  }

  /* Edge-to-edge sections on Home only */
  body.page-home .page-container{
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  body.page-home .category-box,
  body.page-home .chart-card,
  body.page-home .bank-card{
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: transparent !important;
  }

  body.page-home .category-box{ padding: 10px 8px 12px !important; }
  body.page-home .chart-card{ padding: 12px 10px 14px !important; }

  body.page-home .section-divider,
  body.page-home #txDivider{
    margin: 10px 0 !important;
    border-top: 1px solid var(--border) !important;
  }

  /* =============================================================================
     Bank Totals (Home, mobile) — show acct count + (Card Balances) Avail/% used WITHOUT expanding
     ============================================================================= */

  /* Prevent any inherited flex from generic ".category-box > div" rules */
  body.page-home #bankTotals{
    display: block !important;
  }

  body.page-home #bankTotals .bank-accordion{
    margin: 8px 0;
  }

  body.page-home #bankTotals .bank-accordion__header{
    display: grid !important;
    grid-template-columns: 1fr auto;
    grid-template-rows: auto auto;
    gap: 2px 10px;
    align-items: center !important;

    padding: 10px 12px !important;
    border-radius: 14px !important;

    /* IMPORTANT: allow header to grow for subline */
    height: auto !important;
    min-height: 0 !important;
    overflow: visible !important;
  }

  /* Left: title + "N acct" */
  body.page-home #bankTotals .bank-accordion__header > span:first-child{
    grid-column: 1;
    grid-row: 1 / span 2;
    min-width: 0 !important;

    display: flex !important;
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 2px !important;
    line-height: 1.1 !important;
  }

  body.page-home #bankTotals .bank-accordion__meta{
    margin-left: 0 !important;
    font-size: 11px !important;
    font-weight: 800 !important;
    opacity: .70 !important;
    white-space: nowrap !important;
  }

  /* Right: total + optional subline */
  body.page-home #bankTotals .bank-accordion__right{
    grid-column: 2;
    grid-row: 1 / span 2;
    min-width: 0 !important;

    display: flex !important;
    flex-direction: column !important;
    align-items: flex-end !important;
    gap: 2px !important;

    height: auto !important;
    overflow: visible !important;
  }

  body.page-home #bankTotals .bank-accordion__right > div:first-child{
    font-size: 14px !important;
    font-weight: 900 !important;
    line-height: 1.1 !important;
    white-space: nowrap !important;
  }

  /* "Avail … • % used" line */
  body.page-home #bankTotals .bank-accordion__sub{
    display: block !important;
    font-size: 11px !important;
    font-weight: 800 !important;
    opacity: .78 !important;
    white-space: nowrap !important;
  }

  /* =============================================================================
     Month buttons rows (all pages)
     ============================================================================= */

  #monthButtons,
  #aButtons,
  #catMonthButtons,
  #spMonthButtons{
    display: flex !important;
    flex-wrap: nowrap !important;
    gap: 8px !important;

    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;

    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-x: contain;
    touch-action: pan-x;

    justify-content: flex-start !important;
    padding: 6px 12px 2px 2px !important;
  }

  #monthButtons::-webkit-scrollbar,
  #aButtons::-webkit-scrollbar,
  #catMonthButtons::-webkit-scrollbar,
  #spMonthButtons::-webkit-scrollbar{
    height: 0;
  }

  #monthButtons .month-btn,
  #aButtons .month-btn,
  #catMonthButtons .month-btn,
  #spMonthButtons .month-btn{
    flex: 0 0 auto !important;
    padding: 8px 10px;
    border-radius: 999px;
    font-size: 12px;
    white-space: nowrap;
  }

  .month-btn.is-annual{ font-weight: 800; }

  #monthSelect,
  #aMonthSelect{
    width: 100%;
    max-width: 320px;
    padding: 10px 12px;
    border-radius: 12px;
    border: 1px solid rgba(0,0,0,0.2);
    font-size: 14px;
    font-weight: 600;
    background: #fff;
  }

  /* =============================================================================
     Charts (mobile)
     ============================================================================= */

  .chart-controls.chart-controls-grid2{
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 10px !important;
    max-width: 100% !important;
  }

  .chart-controls-center{
    display: flex !important;
    flex-wrap: nowrap !important;
    gap: 10px !important;

    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;

    overflow-x: auto !important;
    overflow-y: hidden !important;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-x: contain;
    touch-action: pan-x;

    justify-content: center !important;
    padding: 6px 12px 2px 2px !important;
  }

  .chart-quarters,
  .chart-year-group{
    flex: 0 0 auto;
    display: flex !important;
    gap: 8px !important;
    flex-wrap: nowrap !important;
    align-items: center;
    white-space: nowrap;
  }

  .chart-year-group button{
    padding: 8px 10px;
    border-radius: 12px;
  }
  .chart-year-group span{
    font-weight: 800;
    white-space: nowrap;
  }

  .cat-layout{ flex-direction: column; }
  .cat-sidebar{ width: 100%; flex: 0 0 auto; }

  .chart-canvas-box{
    max-width: 100% !important;
    overflow-x: hidden !important;
    height: 300px;
  }

  .chart-card{
    overflow: visible;
    max-width: 100% !important;
    width: 100% !important;
    overflow-x: hidden !important;
  }

  .chart-canvas-box{ overflow: hidden !important; }

  .chart-header.chart-header--metrics2{
    display: grid !important;
    grid-template-columns: 1fr auto !important;
    grid-template-areas:
      "title next"
      "total growth"
      "gtoggle gtoggle"
      "dates dates";
    gap: 10px !important;
    align-items: start !important;
  }

  .chart-header--metrics2 .chart-header-center{
    grid-area: title !important;
    justify-content: flex-start !important;
  }

  .chart-title-wrap{ align-items: flex-start !important; }
  .chart-title-wrap h2{
    max-width: 100% !important;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .chart-header--metrics2 .chart-header-actions{
    grid-area: next !important;
    justify-self: end !important;
  }

  .chart-header--metrics2 .chart-header-metrics{ display: contents !important; }

  .chart-header--metrics2 .chart-breakdown--metric{
    grid-area: total !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  .chart-header--metrics2 .chart-metric-stack{
    grid-area: growth !important;
    width: 100% !important;
    min-width: 0 !important;
    align-self: start !important;
  }

  .chart-header--metrics2 .chart-breakdown--metric,
  .chart-header--metrics2 .chart-metric-stack .chart-breakdown{
    height: 44px !important;
    display: flex !important;
    align-items: center !important;
    width: 100% !important;
    min-width: 0 !important;
  }

  .chart-growth-toggle{
    grid-area: gtoggle !important;
    display: flex !important;
    justify-content: center !important;
  }

  .chart-header-dates{
    grid-area: dates !important;
    display: grid !important;
    grid-template-columns: 1fr 1fr auto !important;
    gap: 10px !important;
    max-width: 100%;
  }

  .chart-dates-inline--header{ display: contents !important; }
  .chart-dates-inline--header input[type="date"]{
    height: 40px;
    width: 100%;
  }

  /* Account page title centering */
  body.page-account .chart-header.chart-header--metrics2{
    grid-template-areas:
      "title title"
      "total growth"
      "gtoggle gtoggle"
      "dates dates";
  }
  body.page-account .chart-header--metrics2 .chart-header-center{
    justify-content: center !important;
    grid-column: 1 / -1 !important;
  }
  body.page-account .chart-title-wrap{ align-items: center !important; }
  body.page-account .chart-title-wrap h2{ text-align: center !important; }

  /* =============================================================================
     Generic transaction row tighten (used on other pages)
     ============================================================================= */

  .tx-row{
    grid-template-columns: max-content 1fr auto;
    gap: 8px;
    padding: 8px 10px;
    padding-left: 72px; /* default tx-row icon offset */
    max-width: 100%;
    box-sizing: border-box;
  }

  .tx-date{ font-size: 11px; }
  .tx-merchant{ font-size: 13px; }
  .tx-sub{ font-size: 10px; }
  .tx-amt{ font-size: 13px; }

  .section-divider{ margin: 16px 0; }

  /* =============================================================================
     Bottom tabs (mobile bar)
     ============================================================================= */

  .mobile-tabs{
    left: 0;
    right: 0;
    bottom: env(safe-area-inset-bottom);
    transform: none;

    height: 64px;
    width: auto;

    border-radius: 0;
    border: none;
    border-top: 1px solid rgba(0,0,0,0.12);
    box-shadow: none;

    padding: 8px 10px;
    gap: 10px;
  }

  .mobile-tab{
    border: 1px solid rgba(0,0,0,0.14);
    border-radius: 14px;
    font-weight: 800;
    font-size: 12px;
    padding: 0;
    justify-content: center;
  }

  .mobile-tab.active{
    background: #111;
    color: #fff;
    border-color: #111;
  }

  /* =============================================================================
     RECURRING (mobile) — single card per merchant, FULL WIDTH
     ============================================================================= */

  body.page-recurring .page-container{
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  body.page-recurring .cal-box,
  body.page-recurring .category-box{
    border: none !important;
    border-radius: 0 !important;
    box-shadow: none !important;
    background: transparent !important;
    padding: 10px 10px 12px !important;
  }

  body.page-recurring .rec-card{
    margin: 12px 0 !important;
    border-top: 1px solid var(--border) !important;
    border-bottom: 1px solid var(--border) !important;
    border-left: 0 !important;
    border-right: 0 !important;
    border-radius: 0 !important;
    background: #fff !important;
    overflow: visible !important;
  }

  body.page-recurring .rec-head{
    display: grid;
    grid-template-columns: 28px 1fr auto;
    gap: 10px;
    align-items: center;

    padding: 10px 12px !important;
    background: rgba(0,0,0,0.02);
  }

  body.page-recurring .rec-toggle{
    width: 28px;
    height: 28px;
    border-radius: 10px;
    border: 1px solid var(--border);
    background: #fff;
    font-weight: 900;
    line-height: 1;
  }

  body.page-recurring .rec-head-main{
    min-width: 0 !important;
  }

  body.page-recurring .rec-merchant-name{
    appearance: none;
    border: 0;
    background: transparent;
    padding: 0;
    margin: 0;
    text-align: left;

    display: block;
    width: 100% !important;
    max-width: 100% !important;

    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;

    font-size: 13px !important;
    font-weight: 900;

    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  body.page-recurring .rec-merchant-sub{
    font-size: 10px !important;
    opacity: .65;
    margin-top: 2px;
  }

  body.page-recurring .rec-merchant-actions{
    display: flex;
    gap: 8px;
    flex: 0 0 auto;
  }

  body.page-recurring .pill-btn{
    height: 28px;
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: #fff;
    font-weight: 900;
    font-size: 12px;
    white-space: nowrap;
  }

  body.page-recurring .pill-btn--sub{
    font-size: 11px;
    padding: 4px 8px;
  }

  body.page-recurring .rec-body{
    border-top: 1px solid rgba(0,0,0,0.08);
    border-bottom: 1px solid rgba(0,0,0,0.08);
  }

  body.page-recurring .rec-item{
    display: grid;
    grid-template-columns: 44px 1fr auto;
    gap: 10px;
    align-items: center;

    padding: 10px 12px;
    border-bottom: 1px solid rgba(0,0,0,0.06);
  }
  body.page-recurring .rec-item:last-child{
    border-bottom: 0;
  }

  body.page-recurring .rec-item .tx-icon-wrap{
    position: static !important;
    left: auto !important;
    top: auto !important;

    width: 34px !important;
    height: 34px !important;
    border-radius: 999px !important;

    display: grid;
    place-items: center;
    justify-self: start;
    align-self: center;
  }

  body.page-recurring .rec-mid{
    min-width: 0 !important;
  }

  body.page-recurring .rec-freq{
    font-size: 11px;
    font-weight: 900;
    opacity: .8;
    text-transform: lowercase;
  }

  body.page-recurring .rec-meta{
    font-size: 10px;
    opacity: .65;
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  body.page-recurring .rec-right{
    display: flex;
    align-items: center;
    gap: 10px;
  }

  body.page-recurring .rec-amt{
    font-weight: 900;
    font-size: 12px;
    white-space: nowrap;
  }

  body.page-recurring .rec-card.is-collapsed .rec-body{
    display: none;
  }

  /* Bubble */
  .name-bubble{
    position: fixed;
    z-index: 2147483647;
    max-width: min(320px, calc(100vw - 24px));
    padding: 8px 10px;
    border-radius: 12px;
    background: rgba(20,20,20,0.92);
    color: #fff;
    font-size: 12px;
    font-weight: 800;
    line-height: 1.2;
    box-shadow: 0 10px 24px rgba(0,0,0,0.25);
    pointer-events: none;
    opacity: 0;
    transform: translate(-50%, -8px);
    transition: opacity .12s ease, transform .12s ease;
  }
  .name-bubble.is-on{
    opacity: 1;
    transform: translate(-50%, -14px);
  }
  .name-bubble::after{
    content:"";
    position: absolute;
    left: 50%;
    bottom: -6px;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 6px solid transparent;
    border-right: 6px solid transparent;
    border-top: 6px solid rgba(20,20,20,0.92);
  }

  /* =============================================================================
     Receipts page (mobile)
     ============================================================================= */

  .wrap{
    width: 100% !important;
    max-width: none !important;
    margin: 12px auto !important;
    padding: 0 10px !important;
    box-sizing: border-box !important;
  }

  .wrap .row.card{
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 10px !important;
  }

  .wrap .card{
    padding: 12px !important;
    border-radius: 14px !important;
  }

  .wrap .grid{
    grid-template-columns: 1fr !important;
    gap: 10px !important;
  }
  .wrap .grid .row{
    justify-content: flex-start !important;
  }
  .wrap .grid .row .btn{
    width: 100% !important;
  }

  .modalBack{
    padding: 10px !important;
  }
  .modal{
    width: 100% !important;
    max-height: 92vh !important;
    border-radius: 16px !important;
    padding: 12px !important;
  }

  .two{
    grid-template-columns: 1fr !important;
  }

  input, select, .btn{
    font-size: 16px; /* prevents iOS zoom on focus */
  }
  input, select{
    padding: 10px 12px !important;
  }
  .btn{
    padding: 10px 12px !important;
  }
/* Tighten ONLY the chart header date inputs */
.chart-dates-inline--header input[type="date"]{
  height: 34px !important;
  padding: 0 10px !important;
  box-sizing: border-box;
}

  details .two{
    grid-template-columns: 1fr !important;
  }

  img.preview{
    max-height: 55vh;
    object-fit: contain;
  }

  /* Calendar: icon stack (mobile only) */
  .cal-icons{
    display: flex;
    align-items: center;
    margin-top: 4px;
  }

  .cal-ic{
    width: 18px;
    height: 18px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    overflow: hidden;
  }

  .cal-ic + .cal-ic{
    margin-left: -9px; /* 50% overlap */
  }

  .cal-ic svg{
    width: 14px;
    height: 14px;
    display: block;
  }

  body.page-recurring .category-box > div{
    gap: 8px;
  }

  body.page-recurring .category-box label{
    font-size: 13px;
  }

  /* =============================================================================
     HOME tx cards (mobile) — match desktop layout
     (keep ONE copy)
     ============================================================================= */
  body.page-home .tx-row{
    position: relative;
    display: grid;
    grid-template-columns: max-content 1fr auto; /* date | main | amount */
    align-items: center;
    padding-left: 72px; /* room for icon */
  }

  body.page-home .tx-icon-wrap{
    position: absolute !important;
    left: 12px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    width: 38px;
    height: 38px;
  }

  body.page-home .tx-amt{
    justify-self: end;
    white-space: nowrap;
  }
  /* Projected growth overlay — compact on mobile */
.chart-growth-overlay{
  top: 6px !important;
  right: 6px !important;

  padding: 4px 8px !important;
  gap: 6px !important;

  font-size: 12px !important;
  line-height: 1 !important;
}

/* Shrink checkbox a bit */
.chart-growth-overlay input[type="checkbox"]{
  transform: scale(0.85);
}

/* Optional: tighten label text */
.chart-growth-overlay label,
.chart-growth-overlay span{
  font-size: 12px !important;
  opacity: 0.9;
}

}

/* =============================================================================
   Smaller phones: calendar density tweaks
   ============================================================================= */
@media (max-width: 520px){
  .cal-day{
    min-height: 52px !important;
    padding: 4px !important;
    border-radius: 8px !important;
  }
  .cal-daynum{
    font-size: 10px !important;
    opacity: .7;
  }
  .cal-chip{
    font-size: 9px !important;
    padding: 2px 4px !important;
  }

  .cal-icons{
    display: flex;
    align-items: center;
    margin-top: 4px;
  }
  .cal-ic{
    width: 18px;
    height: 18px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 999px;
    overflow: hidden;
  }
  .cal-ic + .cal-ic{
    margin-left: -9px;
  }
  .cal-ic svg{
    width: 14px;
    height: 14px;
    display: block;
  }


  /* ============================
   RECURRING (mobile) — stop wrapper clipping + true edge-to-edge
   ============================ */

body.page-recurring .page-container{
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* These wrappers are what clip the edges */
body.page-recurring .cal-box,
body.page-recurring .category-box{
  background: transparent !important;
  border: 0 !important;
  border-radius: 0 !important;
  padding: 0 !important;
  margin: 0 !important;
  overflow: visible !important; /* <- THIS prevents edge cutoff */
}

/* Keep the calendar area padded (but not the whole wrapper) */
body.page-recurring .cal-head,
body.page-recurring #calSummary,
body.page-recurring .cal-weekdays,
body.page-recurring #calGrid{
  padding-left: 12px !important;
  padding-right: 12px !important;
}
body.page-recurring .cal-head{ padding-top: 10px !important; }
body.page-recurring #calGrid{ padding-bottom: 10px !important; }

/* Controls padded; list edge-to-edge */
body.page-recurring .category-box__header{ padding: 12px 12px 8px !important; }
body.page-recurring .category-box > label{ padding: 0 12px 8px !important; }
body.page-recurring .category-box > div{ padding: 0 12px 12px !important; }

body.page-recurring #recurringList{
  width: 100% !important;
  max-width: 100% !important;
  margin: 0 !important;
  padding: 0 !important;
}
/* Keep each control from shrinking weirdly */
  body.page-recurring .category-box > div > *{
    flex: 0 0 auto !important;
  }

  /* Make the number input compact and not stretch */
  body.page-recurring #minOcc{
    width: 64px !important;
    height: 28px !important;
    padding: 0 8px !important;
    text-align: center !important;
  }

  /* Keep buttons consistent height */
  body.page-recurring .category-box button{
    height: 28px !important;
    padding: 0 12px !important;
    white-space: nowrap !important;
  }

  /* Optional: hide scrollbar but keep scroll */
  body.page-recurring .category-box > div::-webkit-scrollbar{
    height: 0;
  }

  /* Make Start/End not stretch crazy wide */
.chart-header-dates{
  grid-template-columns: max-content max-content auto !important;
  justify-content: start !important;
}

/* Labels should size to content, not fill 1fr columns */
.chart-dates-inline--header label{
  display: inline-flex !important;
  align-items: center !important;
  gap: 6px !important;
}

/* Cap the actual date input width */
.chart-dates-inline--header input[type="date"]{
  width: 150px !important;
  max-width: 150px !important;
}

}

.date-row {
  display: flex;
  gap: 10px;
  align-items: center;
}

.date-box {
  flex: 0 0 150px;   /* ← key line */
  max-width: 150px;
}

.update-btn {
  margin-left: 4px;
  padding: 10px 14px;
}
