<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="data:,">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Finance" />

  <meta name="theme-color" content="#ffffff" />
  <link rel="manifest" href="/static/manifest.webmanifest" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
/>

  <meta charset="UTF-8" />
  <link rel="stylesheet" href="/static/css/base.css">
  <link rel="stylesheet" href="/static/css/mobile.css">
  <script src="/static/theme.js"></script>
</head>

<body class="page-home" data-page-title="Home">
<div class="page-container">

  <!-- Shared top bar (settings + title + optional back button) -->
  <div id="topBar"></div>

    <!-- ADD: data-home-section directly on the existing block -->
    <div id="homeChartMount" data-home-section="chart"></div>

    <hr class="section-divider" />

    <div id="upcomingMount" data-home-section="upcoming" style="margin-top:14px;"></div>

    <hr class="section-divider" />

    <!-- ADD: data-home-section on the existing bank-area section -->
    <section class="bank-area" data-home-section="bankArea">

      <!-- ADD: id + data-sidebar-section on existing cards (no markup change) -->
      <aside class="sidebar-stack" id="sidebarStack">

      <div id="monthBudget" class="category-box category-box--sidebar"
     data-sidebar-section="monthBudget" aria-label="Month budget">
  <div class="category-box__header">This month</div>

  <div class="month-budget__top">
    <div class="mb-kpi">
      <div class="mb-label">Safe to spend</div>
      <div class="mb-value" id="mbSafe">—</div>
    </div>
    <div class="mb-meta" id="mbMeta">—</div>
    <div class="mb-goal" id="mbGoal" style="margin-top:6px; font-size:12px; opacity:.75;">—</div>
  </div>

  <div class="mb-bar" aria-hidden="true">
    <div class="mb-bar__fill" id="mbBarFill" style="width:0%"></div>
  </div>

  <!-- IMPORTANT: restore the pill layout your CSS styles -->
  <ul class="category-box__list" style="margin-top:10px;">
    <li id="mbIncomeRow" class="category-pill" role="button" tabindex="0"
        style="cursor:pointer;" title="View expected income breakdown">
      <div class="cat-left"><span class="cat-name">Expected income</span></div>
      <span class="cat-amt" id="mbIncome">—</span>
    </li>

    <li class="category-pill is-static">
      <div class="cat-left"><span class="cat-name">Spent so far</span></div>
      <span class="cat-amt" id="mbSpent">—</span>
    </li>

    <li class="category-pill is-static">
      <div class="cat-left"><span class="cat-name">Remaining bills</span></div>
      <span class="cat-amt" id="mbBills">—</span>
    </li>
  </ul>
</div>


        <div id="categoryTotals" class="category-box category-box--sidebar"
             data-sidebar-section="monthlySpending">
          <div class="category-box__header">Monthly Spending</div>
          <ul id="categoryTotalsList" class="category-box__list"></ul>
        </div>

      </aside>

      <div class="bank-main">
        <div class="category-box bank-box-fill">
          <div class="category-box__header" id="bankTotalsHeader"
               style="display:flex; align-items:center; gap:8px;">
            <span>Bank Totals</span>
            <button id="bankInfoBtn" class="icon-btn" title="Bank info" aria-label="Bank info">i</button>
          </div>

          <div id="bankTotals"></div>
        </div>
      </div>

    </section>

    <hr id="txDivider" class="section-divider" />

    <!-- ADD: data-home-section on existing transactions section -->
    <section aria-label="Transactions" data-home-section="transactions">
      <div class="category-box">
        <div class="category-box__header">Recent Transactions</div>
        <div id="txList" class="tx-list"></div>
      </div>
    </section>

  </div><!-- /.page-container -->

  <!-- KEEP: rule modal, bottom tabs, bank info panel, service worker script, etc. -->
  <div id="bottomTabs"></div>

  <!-- Rule Modal (Unassigned) -->
<div id="ruleModalBackdrop" class="modal-backdrop" style="display:none;">
  <div class="modal-card" role="dialog" aria-modal="true" aria-label="Create rule">
    <div class="modal-head">
      <div>
        <div class="modal-title">Create rule</div>
        <div id="ruleCounter" class="modal-sub">—</div>
      </div>
      <button id="ruleModalClose" class="icon-btn" type="button" aria-label="Close">✕</button>
    </div>

    <div class="modal-body">
      <input id="ruleTxId" type="hidden" />

      <div class="tx-kv" style="margin-bottom:12px;">
        <div class="tx-kv__k">Merchant</div><div id="ruleTxMerchant" class="tx-kv__v">—</div>
        <div class="tx-kv__k">Account</div><div id="ruleTxAccount" class="tx-kv__v">—</div>
        <div class="tx-kv__k">Amount</div><div id="ruleTxAmount" class="tx-kv__v">—</div>
        <div class="tx-kv__k">Date</div><div id="ruleTxDate" class="tx-kv__v">—</div>
      </div>

      <div class="modal-row">
        <label>Category</label>
        <input id="ruleCategory" list="categoryOptions" placeholder="Start typing…" />
        <datalist id="categoryOptions"></datalist>
      </div>

      <div class="modal-row">
        <label>Keywords (comma separated)</label>
        <input id="ruleKeywords" type="text" placeholder="e.g. amazon, prime" />
      </div>

      <label class="modal-row" style="display:flex; gap:8px; align-items:center;">
        <input id="ruleApplyNow" type="checkbox" checked />
        Apply to existing transactions
      </label>

      <div class="modal-actions" style="display:flex; gap:10px; justify-content:space-between; align-items:center;">
        <div style="display:flex; gap:8px;">
          <button id="rulePrevBtn" class="btn" type="button">‹ Prev</button>
          <button id="ruleNextBtn" class="btn" type="button">Next ›</button>
        </div>

        <button id="ruleSaveBtn" class="btn btn-primary" type="button">Save</button>
      </div>

      <div id="ruleSaveMsg" class="mini-note" style="margin-top:10px;"></div>
    </div>
  </div>
</div>


<div id="bankInfoOverlay" class="overlay hidden"></div>

<div id="bankInfoPanel" class="side-panel hidden">
  <div class="panel-header">
    <div>
      <div class="panel-title">Bank info</div>
      <div id="bankInfoSubtitle" class="panel-subtitle"></div>
    </div>
    <button id="bankInfoClose" class="icon-btn">✕</button>
  </div>

  <div id="bankInfoBody" class="panel-body"></div>
</div>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/static/sw.js").catch(console.error);
    }
  </script>

  <script src="/static/topBar.js"></script>
<script src="/static/notifs.js" defer></script>
  <script src="/static/txInspect.js"></script>
  <script src="/static/bankInfo.js"></script>
  <script src="/static/profile.js"></script>
  <script src="/static/bottomTabs.js"></script>
  <script src="/static/category_icons.js"></script>
  <script src="/static/upcomingCard.js"></script>
  <script src="/static/chartControls.js"></script>
  <script src="/static/chartCard.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- NEW -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <script src="/static/layout.js"></script>

  <script src="/static/home.js"></script>
</body>
</html>
